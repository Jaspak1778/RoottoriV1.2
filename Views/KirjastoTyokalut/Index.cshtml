﻿@model IEnumerable<RoottoriV1._2.Models.KirjastoTyokalut>

@{
    ViewBag.Title = "Työkalut";
}

<th class="container">
    @using (Html.BeginForm("Index", "KirjastoTyokalut", FormMethod.Get))
    {
        <div class="row">
            <div class="col-3">
                <h2>Työkalukirjasto</h2>
            </div>
            <div class="col-auto">
                <input class="form" id="searchString1" name="searchString1" placeholder="Haku" style="width:200px;" type="text" value="">
            </div>
            <div class="col-4">
                <input class="btn btn-dark btn-sm" type="submit" value="Etsi" />
            </div>
            <div class="col">
                <a class="btn btn-dark btn-sm" data-toggle="tooltip" data-placement="bottom" title="Lisää työkalutieto" href="/KirjastoTyokalut/Create"><img src="~/Icons/plus.svg" width="24" height="24" aria-label="Luo" />Työkalu</a>
            </div>
        </div>
    }
            <br />
            <table class="table">
                <thead>
                    <tr>
                        <th><p>Kategoria</p></th>
                        <th><p>TKnro</p></th>
                        <th><p>Työkalun nimi</p></th>
                        <th><p>Pituus</p></th>
                        <th><p>Halkaisija</p></th>
                        <th><p>Pala</p></th>
                        <th><p>Linkki</p></th>
                        <th><p>Lisatieto1</p></th>
                        <th><p>Kone</p></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.TyokaluKategoriaID)</td>
                            <td>@Html.DisplayFor(modelItem => item.TyokaluNro)</td>
                            <td>@Html.DisplayFor(modelItem => item.TyokalunNimi)</td>
                            <td>@Html.DisplayFor(modelItem => item.Pituus)</td>
                            <td>@Html.DisplayFor(modelItem => item.Halkaisija)</td>
                            <td>@Html.DisplayFor(modelItem => item.Pala)</td>
                            <td><a href="@item.ImageLink">Linkki</a></td>
                            <td>@Html.DisplayFor(modelItem => item.Lisatieto1)</td>
                            <td>@Html.DisplayFor(modelItem => item.Koneet.Kone)</td>


                            <td>
                                @Html.ActionLink("Muokkaa", "Edit", new { id = item.TyokaluID }) |
                                @Html.ActionLink("Lisätiedot", "Details", new { id = item.TyokaluID }) |
                                @Html.ActionLink("Poista", "Delete", new { id = item.TyokaluID })
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            @*Sortteeraus script*@

            @section Scripts {
                @Scripts.Render("~/bundles/jqueryval")
                <script>
                    const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;
                    const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
                        v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
                    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));
                    document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
                        const table = th.closest('table');
                        const tbody = table.querySelector('tbody');
                        Array.from(tbody.querySelectorAll('tr'))
                            .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
                            .forEach(tr => tbody.appendChild(tr));
                    })));
                </script>
            }
